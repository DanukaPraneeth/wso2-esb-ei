<?xml version="1.0" encoding="UTF-8"?>
<sequence name="com.apigate.omoney.merchantPaymentResponse" onError="com.apigate.omoney.faultSequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom">
        <property name="query2" value="*********** recieved from Orange back-end *************"/>
    </log>

    <property expression="json-eval($.pay_token)" name="pay_token" scope="default" type="STRING"/>
    <property expression="json-eval($.notif_token)" name="notif_token" scope="default" type="STRING"/>
    <log level="custom">
        <property expression="$ctx:pay_token" name="Orange Pay Token" xmlns:ns="http://org.apache.synapse/xsd"/>
        <property expression="$ctx:notif_token" name="Orange notif token" xmlns:ns="http://org.apache.synapse/xsd"/>
    </log>
    <dbreport>
        <connection>
            <pool>
                <dsName>jdbc/WSO2TELCO_DEP_DB</dsName>
            </pool>
        </connection>
        <statement>
            <sql><![CDATA[UPDATE OMONEY_LOG SET PAY_TOKEN = ?, NOTIFY_TOKEN = ? WHERE ORDER_ID = ?]]></sql>
            <parameter expression="get-property('pay_token')" type="VARCHAR" xmlns:ns="http://org.apache.synapse/xsd"/>
            <parameter expression="get-property('notif_token')" type="VARCHAR" xmlns:ns="http://org.apache.synapse/xsd"/>
            <parameter expression="get-property('order_id')" type="VARCHAR" xmlns:ns="http://org.apache.synapse/xsd"/>
        </statement>
    </dbreport>

    <log category="DEBUG" level="custom">
        <property value="completed successfully" name="Web payment Orange response database update" xmlns:ns="http://org.apache.synapse/xsd"/>
    </log>
</sequence>