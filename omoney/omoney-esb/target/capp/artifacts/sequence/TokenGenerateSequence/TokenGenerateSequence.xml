<?xml version="1.0" encoding="UTF-8"?>
<sequence name="TokenGenerateSequence" onError="TokenFaultSequence" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom">
        <property name="query" value="*********** Initiated the token generation request *************"/>
    </log>
    <property name="uri.var.omoney_backend.name" scope="default"
              type="STRING" value="webpayment"/>
    <property
            expression="get-property('registry', 'conf:/omoney_config.xml')"
            name="xmlFile" scope="default" type="OM" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:xmlFile//security/consumer_key"
              name="reg_consumer_key" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property
            expression="fn:concat('Basic ', get-property('reg_consumer_key'))"
            name="Authorization" scope="transport" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property name="grant_type" scope="default" type="STRING" value="client_credentials"/>
    <payloadFactory media-type="xml">
        <format>
            <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
                <soapenv:Body>
                    <root xmlns="">
                        <grant_type>$1</grant_type>
                    </root>
                </soapenv:Body>
            </soapenv:Envelope>
        </format>
        <args>
            <arg evaluator="xml" expression="$ctx:grant_type" xmlns:ns="http://org.apache.synapse/xsd"/>
        </args>
    </payloadFactory>
    <property name="messageType" scope="axis2" type="STRING" value="application/x-www-form-urlencoded"/>
    <property name="DISABLE_CHUNKING" scope="axis2" type="STRING" value="true"/>
    <log level="full">
        <property expression="get-property('reg_consumer_key')"
                  name="key" xmlns:ns="http://org.apache.synapse/xsd"/>
        <property name="query" value="*********** Ending the token generation request *************"/>
    </log>
    <send receive="TokenGenerateResponseSequence">
        <endpoint key="omoneyEp"/>
    </send>
</sequence>
